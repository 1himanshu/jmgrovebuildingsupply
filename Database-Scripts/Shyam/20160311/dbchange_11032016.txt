

/****** Object:  Table [dbo].[tbl_Vendor_VendorCat]    Script Date: 03/11/2016 17:54:01 ******/
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[tbl_Vendor_VendorCat]') AND type in (N'U'))
DROP TABLE [dbo].[tbl_Vendor_VendorCat]
GO


/****** Object:  Table [dbo].[tbl_Vendor_VendorCat]    Script Date: 03/11/2016 17:54:01 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE TABLE [dbo].[tbl_Vendor_VendorCat](
	[VendorId] [int] NULL,
	[VendorCatId] [int] NULL
) ON [PRIMARY]

GO



GO

/****** Object:  StoredProcedure [dbo].[USP_GetVendorList]    Script Date: 03/11/2016 17:54:40 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO


ALTER proc [dbo].[USP_GetVendorList]
@FilterParams nvarchar(Max)=null,
@FilterBy nvarchar(50)=null,
@ManufacturerType nvarchar(20)=null,
@VendorCategoryId nvarchar(10)=null
as
BEGIN
	Declare @BaseQuery nvarchar(max) ='select v.VendorName,v.VendorId '
										+'from tbl_Vendor_VendorSubCat V_Vsc '
										+'inner join tblVendors v '
										+'on V_Vsc.VendorId = v.VendorId '
										+'inner join tbl_VendorCat_VendorSubCat Vc_Vsc '
										+'on Vc_Vsc.VendorSubCategoryId=V_Vsc.VendorSubCatId',
			@WhereClause nvarchar(max)=' Where 1=1';
	 if(@FilterBy='VendorSubCategory')
		begin
			set @WhereClause= @WhereClause +' AND V_Vsc.VendorSubCatId=@FilterParams';
		end
	 else if(@FilterBy='VendorCategory')
		begin
		set @BaseQuery='select tv.VendorName,tv.VendorId from tblvendors tv '
						+'inner join tbl_Vendor_VendorCat tvVcat '
						+'on tv.VendorId=tvVcat.Vendorid where tvVcat.VendorCatId=@FilterParams'
			
		end
	 else if(@FilterBy='ProductCategory')
		begin
			set @WhereClause= @WhereClause +' And Vc_Vsc.VendorCategoryId in (select * from dbo.split(@FilterParams,'',''))';
		end
		
	
	if(@FilterBy <> 'VendorCategory')
	begin
		set @BaseQuery = @BaseQuery+@WhereClause+' group by v.VendorName,v.VendorId Order By v.VendorName';
	End	
	--print @BaseQuery
	EXECUTE sp_executesql @BaseQuery,N'@FilterParams nvarchar(max),@FilterBy nvarchar(50),@ManufacturerType nvarchar(20),@VendorCategoryId nvarchar(10)',
							@FilterParams,@FilterBy,@ManufacturerType,@VendorCategoryId
END




GO


